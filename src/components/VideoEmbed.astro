---
// VideoEmbed.astro - Component for embedding videos from YouTube, Instagram, and TikTok

interface Props {
  url: string;
  title?: string;
  width?: string;
  height?: string;
}

const { url, title = "Video de la Guitarra", width = "100%", height = "400px" } = Astro.props;

// Function to detect video platform and extract video ID
function getVideoEmbedInfo(url: string) {
  // YouTube
  const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
  const youtubeMatch = url.match(youtubeRegex);
  if (youtubeMatch) {
    return {
      platform: 'youtube',
      videoId: youtubeMatch[1],
      embedUrl: `https://www.youtube.com/embed/${youtubeMatch[1]}`
    };
  }

  // Instagram
  const instagramRegex = /instagram\.com\/(?:p|reel)\/([a-zA-Z0-9_-]+)/;
  const instagramMatch = url.match(instagramRegex);
  if (instagramMatch) {
    return {
      platform: 'instagram',
      videoId: instagramMatch[1],
      embedUrl: `https://www.instagram.com/p/${instagramMatch[1]}/embed/`
    };
  }

  // TikTok
  const tiktokRegex = /tiktok\.com\/@[^\/]+\/video\/(\d+)/;
  const tiktokMatch = url.match(tiktokRegex);
  if (tiktokMatch) {
    return {
      platform: 'tiktok',
      videoId: tiktokMatch[1],
      embedUrl: `https://www.tiktok.com/embed/v2/${tiktokMatch[1]}`
    };
  }

  return null;
}

const videoInfo = getVideoEmbedInfo(url);
---

{ videoInfo && (
  <div class="video-embed-container" style={`width: ${width}; margin: 20px 0;`}>
    <h3 class="video-title" style="text-align: center; color: #764ba2; margin-bottom: 15px; font-size: 1.4rem;">
      {title}
    </h3>

    {videoInfo.platform === 'youtube' && (
      <div class="video-wrapper" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <iframe
          src={videoInfo.embedUrl}
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
          allowfullscreen
          title={title}
        ></iframe>
      </div>
    )}

    {videoInfo.platform === 'instagram' && (
      <div class="video-wrapper" style="display: flex; justify-content: center; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <iframe
          src={videoInfo.embedUrl}
          style={`width: ${width}; height: ${height}; border: none; max-width: 540px;`}
          allowfullscreen
          title={title}
        ></iframe>
      </div>
    )}

    {videoInfo.platform === 'tiktok' && (
      <div class="video-wrapper" style="display: flex; justify-content: center; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <iframe
          src={videoInfo.embedUrl}
          style={`width: ${width}; height: ${height}; border: none; max-width: 605px;`}
          allowfullscreen
          title={title}
        ></iframe>
      </div>
    )}
  </div>
)}

{!videoInfo && (
  <div class="video-error" style="text-align: center; padding: 20px; background-color: #f8d7da; color: #721c24; border-radius: 8px; margin: 20px 0;">
    <p>❌ URL de video no válida. Solo se admiten enlaces de YouTube, Instagram y TikTok.</p>
    <p style="font-size: 0.9rem; margin-top: 10px;">URL proporcionada: {url}</p>
  </div>
)}

<style>
  .video-embed-container {
    margin: 20px 0;
  }

  .video-title {
    text-align: center;
    color: #764ba2;
    margin-bottom: 15px;
    font-size: 1.4rem;
    font-weight: bold;
  }

  .video-wrapper {
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  /* Responsive design */
  @media (max-width: 768px) {
    .video-embed-container {
      margin: 15px 0;
    }

    .video-title {
      font-size: 1.2rem;
    }

    .video-wrapper iframe {
      border-radius: 6px;
    }
  }

  @media (max-width: 480px) {
    .video-title {
      font-size: 1.1rem;
    }
  }
</style>