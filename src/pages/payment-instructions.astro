---
import HeaderGrisha from "../components/HeaderGrisha.astro";
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        <title>Rifa Grisha - Instrucciones de Pago</title>
        <style>
            body {
                font-family: sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 0;
                background-color: #f4f4f4;
                color: #333;
            }
            main {
                max-width: 800px;
                margin: 50px auto;
                padding: 30px;
                background: #fff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }
            h1 {
                color: #764ba2;
                font-size: 2.5rem;
                margin-bottom: 25px;
                text-align: center;
            }
            h2 {
                color: #28a745;
                font-size: 1.8rem;
                margin-top: 30px;
                margin-bottom: 15px;
            }
            p {
                margin-bottom: 15px;
                font-size: 1.1rem;
            }
            ul {
                list-style-type: none;
                padding: 0;
                margin-bottom: 20px;
            }
            ul li {
                background-color: #eef4f9;
                padding: 15px;
                border-left: 5px solid #667eea;
                margin-bottom: 10px;
                border-radius: 5px;
                display: flex;
                flex-direction: column;
            }
            ul li strong {
                color: #667eea;
                font-size: 1.15rem;
                margin-bottom: 5px;
            }
            .whatsapp-contact {
                margin-top: 40px;
                background-color: #d4edda;
                padding: 20px;
                border-radius: 8px;
                text-align: center;
                border: 1px solid #c3e6cb;
            }
            .whatsapp-contact p {
                font-size: 1.1rem;
                color: #155724;
            }
            .whatsapp-contact a {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                background-color: #25d366;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                text-decoration: none;
                font-weight: bold;
                transition: background-color 0.3s ease;
            }
            .whatsapp-contact a:hover {
                background-color: #1da851;
            }
            .whatsapp-icon {
                width: 20px;
                height: 20px;
                vertical-align: middle;
            }
            .home-button {
                display: inline-block;
                background-color: #764ba2;
                color: white;
                padding: 12px 25px;
                border-radius: 5px;
                text-decoration: none;
                font-weight: bold;
                margin-top: 30px;
                font-size: 1.1rem;
                transition: background-color 0.3s ease;
            }
            .home-button:hover {
                background-color: #6a3e90;
            }
            .send-payment-data {
                text-align: center;
                margin: 30px 0;
            }
            .send-data-button {
                background-color: #28a745;
                color: white;
                padding: 12px 25px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1.1rem;
                transition: background-color 0.3s ease;
            }
            .send-data-button:hover {
                background-color: #218838;
            }
            /* Modal Styles */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(2px);
            }
            .modal-content {
                background-color: #fff;
                margin: 20% auto;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                width: 90%;
                max-width: 400px;
                position: relative;
                text-align: center;
            }
            .close-button {
                position: absolute;
                top: 10px;
                right: 15px;
                color: #aaa;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
            }
            .close-button:hover {
                color: #000;
            }
            .modal-content h3 {
                margin-bottom: 15px;
                font-size: 1.5rem;
            }
            .modal-content h3.success-title {
                color: #28a745;
            }
            .modal-content h3.error-title {
                color: #dc3545;
            }
            .modal-content p {
                margin-bottom: 20px;
                line-height: 1.5;
                color: #333;
            }
            .modal-close-btn {
                background-color: #dc3545;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1rem;
                transition: background-color 0.3s;
            }
            .modal-close-btn:hover {
                background-color: #c82333;
            }
        </style>
    </head>
    <body>
        <HeaderGrisha />
        <main>
            <h1>Instrucciones para Realizar tu Pago</h1>
            <p>
                ¡Felicidades! Tu correo ha sido verificado. Ahora estás a un
                paso de participar en la <strong>Rifa por Grisha</strong> y tener
                la oportunidad de ganar una increíble guitarra de concierto.
            </p>
            <p>
                Por favor, realiza tu pago utilizando alguna de las siguientes
                opciones. Una vez completado, recuerda enviar el comprobante de
                pago por WhatsApp para una verificación rápida.
            </p>

            <h2>Opciones de Pago</h2>
            <ul>
                <li>
                    <strong>Banco Pichincha (Ahorros):</strong>
                    <p>Cuenta No.: 2201988107</p>
                    <p>A nombre de: Juan Isidro Mejía</p>
                    <p>C.I.: 0919315218</p>
                    <p>Email: juanisidromejia@gmail.com</p>
                </li>
                <li>
                    <strong>Banco Produbanco (Ahorros):</strong>
                    <p>Cuenta No.: 12179042454</p>
                    <p>A nombre de: Nadiia Pavliuk</p>
                    <p>C.I.: 0952061414</p>
                    <p>Email: juanisidromejia@gmail.com</p>
                </li>
                <li>
                    <strong>Banco Guayaquil (Ahorros):</strong>
                    <p>Cuenta No.: 0132383827</p>
                    <p>A nombre de: Juan Isidro Mejia Peña</p>
                    <p>C.I.: 0919315218</p>
                    <p>Email: juanisidromejia@gmail.com</p>
                </li>
                <li>
                    <strong>PayPal:</strong>
                    <p>Enlace: <a href="https://paypal.me/juanisidroguitar" target="_blank">https://paypal.me/juanisidroguitar</a></p>
                </li>
                <li>
                    <strong>PayPhone:</strong>
                    <p>Link de Pago: <a href="https://ppls.me/Iz6DkdH4Zb7AdhE74Te6NA" target="_blank">https://ppls.me/Iz6DkdH4Zb7AdhE74Te6NA</a></p>
                    <img src="/img/payphone.jpeg" alt="QR PayPhone" style="max-width: 150px; display: block; margin-top: 10px;" />
                </li>
                <li>
                    <strong>Deuna:</strong>
                    <img src="/img/deuna.jpeg" alt="QR Deuna" style="max-width: 150px; display: block; margin-top: 10px;" />
                </li>
                <li>
                    <strong>Peigo:</strong>
                    <img src="/img/peigo.jpeg" alt="QR Peigo" style="max-width: 150px; display: block; margin-top: 10px;" />
                </li>
            </ul>

            <div class="send-payment-data">
                <button id="send-payment-data-btn" class="send-data-button">Enviar Datos de Pago por Correo</button>
            </div>

            <div class="whatsapp-contact">
                <p>
                    <strong>Paso final:</strong> Una vez realizado el pago, por favor,
                    envíanos el comprobante a nuestro WhatsApp para que podamos verificarlo.
                </p>
                <a
                    id="whatsapp-comprobante-link"
                    href="https://wa.me/+593981985015?text=Hola!%20Ya%20realic%C3%A9%20el%20pago%20para%20la%20rifa.%20Mi%20correo%20es%20[TU%20CORREO]"
                    \
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <img
                        src="/whatsapp-icon.svg"
                        alt="WhatsApp Icon"
                        class="whatsapp-icon"
                    />
                    Enviar Comprobante por WhatsApp
                </a>
                <p
                    style="font-size: 0.9em; margin-top: 10px;"
                    id="whatsapp-note-text"
                >
                    (El correo de registro se incluirá automáticamente en el
                    mensaje.)
                </p>
            </div>

            <p style="text-align: center; margin-top: 40px;">
                Una vez verificado tu pago, te asignaremos y enviaremos tus dos
                números de rifa únicos por correo electrónico. ¡Mucha suerte!
            </p>

            <a href="/" class="home-button">Volver al Inicio</a>
        </main>

        <!-- Message Modal -->
        <div id="message-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h3 id="modal-title">Mensaje</h3>
                <p id="modal-message"></p>
                <button id="modal-close-btn" class="modal-close-btn">Aceptar</button>
            </div>
        </div>
        <script is:inline>
            // Modal elements
            const messageModal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const closeButton = document.querySelector('.close-button');

            // Modal functions
            function showModal(message, type = 'error') {
                modalMessage.textContent = message;
                modalTitle.textContent = type === 'success' ? '¡Excelente!' : 'Error';
                modalTitle.className = type === 'success' ? 'success-title' : 'error-title';
                messageModal.style.display = 'block';
            }

            function hideModal() {
                messageModal.style.display = 'none';
            }

            // Modal event listeners
            modalCloseBtn.addEventListener('click', hideModal);
            closeButton.addEventListener('click', hideModal);
            window.addEventListener('click', (event) => {
                if (event.target === messageModal) {
                    hideModal();
                }
            });

            document.addEventListener("DOMContentLoaded", () => {
                const urlParams = new URLSearchParams(window.location.search);
                const userEmail = urlParams.get("email");
                const whatsappLinkElement = document.getElementById(
                    "whatsapp-comprobante-link",
                );
                const whatsappNoteText =
                    document.getElementById("whatsapp-note-text");

                if (userEmail && whatsappLinkElement) {
                    const baseHref = "https://wa.me/+593981985015?text=";
                    const messageText = encodeURIComponent(
                        `Hola! Ya realicé el pago para la rifa, ahora enviaré el comprobante.  Mi correo es ${userEmail}`,
                    );
                    whatsappLinkElement.href = `${baseHref}${messageText}`;
                    if (whatsappNoteText) {
                        whatsappNoteText.textContent =
                            "Tu correo electrónico se ha añadido automáticamente al mensaje de WhatsApp.";
                    }
                } else if (whatsappNoteText) {
                    whatsappNoteText.textContent =
                        "Para que podamos identificarte rápidamente, por favor, incluye tu correo electrónico en el mensaje de WhatsApp.";
                }

                // Send payment data button
                const sendPaymentDataBtn = document.getElementById('send-payment-data-btn');
                if (sendPaymentDataBtn) {
                    sendPaymentDataBtn.addEventListener('click', async () => {
                        if (!userEmail) {
                            showModal("No se pudo obtener tu correo electrónico. Por favor, verifica que hayas accedido correctamente a esta página.", "error");
                            return;
                        }

                        try {
                            const response = await fetch("/api/send-payment-data", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify({ email: userEmail }),
                            });

                            const data = await response.json();

                            if (response.ok) {
                                showModal("Los datos de pago han sido enviados a tu correo electrónico.", "success");
                            } else {
                                showModal(data.message || "Error al enviar los datos de pago.", "error");
                            }
                        } catch (error) {
                            console.error("Error sending payment data:", error);
                            showModal("Ocurrió un error al enviar los datos de pago.", "error");
                        }
                    });
                }
            });
        </script>
    </body>
</html>
